webpackJsonp([16],{"3G8Z":function(e,t,o){"use strict";var a=o("EuWz"),i=o("Tlu+"),n=o("VU/8"),r=n(a.a,i.a,!1,null,null,null);t.a=r.exports},"7EVb":function(e,t,o){"use strict";t.a={STATUS_IN_ACTIVE:1,STATUS_ACTIVE:2,STATUS_FROZEN:3}},EuWz:function(e,t,o){"use strict";t.a={props:{value:{type:String,required:!0},user:{type:Object}},data:function(){return{inputValue:this.value||""}},methods:{onSave:function(){this.$emit("save")},onChange:function(){this.$emit("change",this.inputValue)}},head:function(){return{}},mounted:function(){},watch:{value:function(e,t){(e=e||"")!==this.inputValue&&(this.inputValue=e)}}}},LY7n:function(e,t,o){"use strict";var a=o("k2/O");t.a={asyncData:function(e){return{book:null,user:e.user}},middleware:"userRequired",components:{book:a.a}}},"M+4+":function(e,t,o){"use strict";var a=function(){var e=this,t=e.$createElement;return(e._self._c||t)("book",{attrs:{book:e.book,user:e.user}})},i=[],n={render:a,staticRenderFns:i};t.a=n},MyuZ:function(e,t,o){"use strict";var a=o("pq6b"),i=o("kaMS"),n=o("VU/8"),r=n(a.a,i.a,!1,null,null,null);t.a=r.exports},O479:function(e,t,o){"use strict";var a=o("mtWM"),i=o.n(a),n=o("y8ae"),r=o("MyuZ"),s=o("3G8Z"),l=o("V8bM"),c=o("FhoZ"),u=o.n(c);t.a={props:["book","user"],data:function(){var e="markdown",t="";return this.book&&(2===this.book.contentType?(e="html",t=this.book.htmlContent):1===this.book.contentType&&(e="markdown",t=this.book.content)),{isMounted:!1,bookID:this.book&&this.book.id||void 0,coverURL:this.book&&this.book.coverURL||"",uploadURL:u.a.uploadURL,file:null,uploaderVisible:!1,croppie:null,imgWidth:188,imgHeight:238,formValidate:{bookName:this.book&&this.book.name||"",contentType:e,content:t||""},ruleInline:{bookName:[{required:!0,message:"请输入图书名称",trigger:"blur"}],contentType:[{required:!0,message:""}],content:[{required:!0,message:"请输入图书简介",trigger:"blur"}]}}},mounted:function(){this.isMounted=!0},head:function(){return{title:this.bookID?"编辑图书":"创建图书",link:[{rel:"stylesheet",href:"/styles/editor/simplemde.min.css"},{rel:"stylesheet",href:"/styles/croppie/croppie.min.css"}],script:[{src:"/javascripts/croppie/croppie.min.js"}]}},methods:{onFormatError:function(){this.$Message.error({duration:u.a.messageDuration,closable:!0,content:"不是有效的图片格式"})},beforeUpload:function(e){var t=this;if(this.file=e,e.size>u.a.sizeLimit)return void this.$Message.error({duration:u.a.messageDuration,closable:!0,content:"图片大小要小于"+u.a.sizeLimitTip});this.uploaderVisible=!this.uploaderVisible;var o=document.getElementById("avatarUploader");o.innerHTML="",this.croppie=null;var a=new FileReader;return a.addEventListener("load",function(){setTimeout(function(){var e={url:a.result,boundary:{width:t.imgWidth+80,height:t.imgHeight+80},viewport:{width:t.imgWidth,height:t.imgHeight,type:"square"}};t.croppie=new window.Croppie(o,e)},200)}),a.readAsDataURL(e),!1},onUpload:function(){var e=this;this.croppie&&this.croppie.result("blob").then(function(t){var o=new FormData;o.append("upFile",t,e.file.name);var a={headers:{"Content-Type":"multipart/form-data"}};i.a.post(e.uploadURL,o,a).then(function(t){var o=t.data;o.errNo===n.a.SUCCESS?(e.coverURL=o.data.url,e.uploaderVisible=!1):e.$Message.error({duration:a.messageDuration,closable:!0,content:o.msg})})})},onContentChange:function(e){this.formValidate.content=e},onContentSave:function(){this.onSubmit()},onSubmit:function(){var e=this;return this.$refs.formValidate.validate(function(t){if(t){var o=e,a=e.bookID?l.a.updateBook:l.a.createBook,i=void 0,r={id:e.bookID,name:e.formValidate.bookName,coverURL:e.coverURL};"html"===e.formValidate.contentType?(i=2,r.htmlContent=e.formValidate.content):"markdown"===e.formValidate.contentType&&(i=1,r.content=e.formValidate.content),r.contentType=i,a({body:r}).then(function(e){e.errNo===n.a.ERROR?o.$Message.error({duration:u.a.messageDuration,closable:!0,content:e.msg}):e.errNo===n.a.LOGIN_TIMEOUT?location.href="/signin?ref="+encodeURIComponent(location.href):(e.errNo,n.a.SUCCESS)}).catch(function(e){o.$Message.error({duration:u.a.messageDuration,closable:!0,content:e.message||e.msg})})}}),!1}},components:{"md-editor":r.a,"html-editor":s.a}}},"Tlu+":function(e,t,o){"use strict";var a=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"golang123-editor"},[o("Input",{attrs:{type:"textarea",rows:40},on:{"on-change":e.onChange},model:{value:e.inputValue,callback:function(t){e.inputValue=t},expression:"inputValue"}})],1)},i=[],n={render:a,staticRenderFns:i};t.a=n},eeMA:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o("LY7n"),i=o("M+4+"),n=o("VU/8"),r=n(a.a,i.a,!1,null,null,null);t.default=r.exports},"k2/O":function(e,t,o){"use strict";function a(e){o("s9AF")}var i=o("O479"),n=o("mSxq"),r=o("VU/8"),s=a,l=r(i.a,n.a,!1,s,null,null);t.a=l.exports},kaMS:function(e,t,o){"use strict";var a=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"golang123-editor"},[e.isMounted?o("textarea",{ref:"textarea"}):e._e(),o("Modal",{attrs:{title:"上传图片"},on:{"on-ok":e.ok,"on-cancel":e.cancel},model:{value:e.modalVisible,callback:function(t){e.modalVisible=t},expression:"modalVisible"}},[o("Upload",{attrs:{"on-success":e.onUploadCallback,name:"upFile",format:["jpg","jpeg","png","gif"],action:e.uploadURL}},[o("Button",{attrs:{type:"ghost",icon:"ios-cloud-upload-outline"}},[e._v("上传图片")])],1)],1),e.isFullscreen?o("div",{staticClass:"editor-fullScreen-save"},[o("Button",{attrs:{type:"primary"},on:{click:e.onSave}},[e._v("保  存")])],1):e._e()],1)},i=[],n={render:a,staticRenderFns:i};t.a=n},mSxq:function(e,t,o){"use strict";var a=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"book-box"},[o("div",{staticClass:"book-main"},[o("ul",{staticClass:"book-nav"},[e._m(0),e._m(1),o("li",[o("span",{staticClass:"book-label"},[e._v(e._s(e.bookID?"编辑图书":"创建图书"))])])]),o("div",{staticClass:"editor-box-wrap"},[o("div",{staticClass:"book-area"},[o("Form",{ref:"formValidate",attrs:{model:e.formValidate,rules:e.ruleInline,"label-width":80}},[o("Form-item",{attrs:{label:"图书名称",prop:"bookName"}},[o("Input",{staticStyle:{width:"400px"},attrs:{placeholder:"请输入图书名称"},model:{value:e.formValidate.bookName,callback:function(t){e.formValidate.bookName=t},expression:"formValidate.bookName"}})],1),o("Form-item",{attrs:{label:"封面图片",prop:"bookPic"}},[o("div",{staticClass:"book-img",style:{width:e.imgWidth+2+"px",height:e.imgHeight+2+"px"}},[o("img",{attrs:{src:e.coverURL}})]),o("Upload",{attrs:{action:"",accept:"image/*","show-upload-list":!1,"before-upload":e.beforeUpload,name:"upFile",format:["jpg","jpeg","png"],"on-format-error":e.onFormatError}},[o("Button",{attrs:{type:"ghost",icon:"ios-cloud-upload-outline"}},[e._v("上传封面图片")])],1),o("Modal",{attrs:{width:"400"},model:{value:e.uploaderVisible,callback:function(t){e.uploaderVisible=t},expression:"uploaderVisible"}},[o("div",{staticStyle:{color:"#f60","text-align":"center"},attrs:{slot:"header"},slot:"header"},[o("p",{attrs:{id:"uploader-pop-title"}},[e._v("编辑封面图片")]),o("p",{attrs:{id:"uploader-pop-subheading"}},[e._v("调整尺寸和位置")])]),o("div",{attrs:{id:"avatarUploader"}}),o("div",{attrs:{slot:"footer"},slot:"footer"},[o("Button",{attrs:{type:"primary",long:""},on:{click:e.onUpload}},[e._v("保存")])],1)])],1),o("Form-item",{attrs:{label:"图书格式",prop:"contentType"}},[e.bookID?o("div",[e._v(e._s(e.formValidate.contentType))]):o("div",[e.isMounted?o("RadioGroup",{model:{value:e.formValidate.contentType,callback:function(t){e.formValidate.contentType=t},expression:"formValidate.contentType"}},[o("Radio",{attrs:{label:"markdown"}}),o("Radio",{attrs:{label:"html"}})],1):e._e()],1)]),o("Form-item",{attrs:{label:"图书简介",prop:"content"}},[o("div",{directives:[{name:"show",rawName:"v-show",value:"html"===e.formValidate.contentType,expression:"formValidate.contentType === 'html'"}],staticClass:"chapter-html-editor"},[o("html-editor",{attrs:{value:e.formValidate.content,user:e.user},on:{save:e.onContentSave,change:e.onContentChange}})],1),o("md-editor",{directives:[{name:"show",rawName:"v-show",value:"markdown"===e.formValidate.contentType,expression:"formValidate.contentType === 'markdown'"}],attrs:{value:e.formValidate.content,user:e.user},on:{save:e.onContentSave,change:e.onContentChange}})],1),o("Form-item",{attrs:{"label-width":0}},[e.isMounted?o("Button",{attrs:{size:"large",type:"primary"},on:{click:e.onSubmit}},[e._v(e._s(e.bookID?"保存图书":"创建图书"))]):e._e()],1)],1)],1)])])])},i=[function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("li",[o("a",{attrs:{href:"/"}},[o("span",[e._v("主页")])])])},function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("li",{staticClass:"book-nav-sep"},[o("span",[e._v("/")])])}],n={render:a,staticRenderFns:i};t.a=n},pq6b:function(e,t,o){"use strict";var a=o("y8ae"),i=o("7EVb"),n=o("FhoZ"),r=o.n(n);t.a={props:{value:{type:String,required:!0},user:{type:Object}},data:function(){return{isMounted:!1,host:"",simplemde:null,SimpleMDE:null,uploadURL:r.a.uploadURL,modalVisible:!1,toolbar:null,isFullscreen:!1}},methods:{ok:function(){},cancel:function(){},showUpload:function(){if(this.user.status===i.a.STATUS_IN_ACTIVE)return void this.$Message.error({duration:r.a.messageDuration,closable:!0,content:"账号未激活，不能上传图片"});this.modalVisible=!0},onToggleFullScreen:function(e){e.toggleFullScreen(),this.isFullscreen=!this.isFullscreen},onSave:function(){this.$emit("save")},onUploadCallback:function(e,t){if(e)if(e.errNo===a.a.SUCCESS){var o=e.data.url;this.simplemde.setImageURL(o),this.SimpleMDE.drawImage(this.simplemde)}else e.errNo===a.a.IN_ACTIVE?(this.modalVisible=!1,this.$Message.error({duration:r.a.messageDuration,closable:!0,content:"账号未激活，不能上传图片"})):e.errNo===a.a.ERROR?(this.modalVisible=!1,this.$Message.error({duration:r.a.messageDuration,closable:!0,content:e.msg})):e.errNo===a.a.LOGIN_TIMEOUT&&(location.href="/signin?ref="+encodeURIComponent(location.href))}},head:function(){return{script:[{src:"/javascripts/editor/simplemde.js"}]}},mounted:function(){this.isMounted=!0,this.$nextTick(function(){this.host=document.location.hostname;var e=window.SimpleMDE;this.toolbar=[{name:"bold",action:e.toggleBold,className:"fa fa-bold",title:"粗体"},{name:"italic",action:e.toggleItalic,className:"fa fa-italic",title:"斜体"},{name:"heading",action:e.toggleHeadingSmaller,className:"fa fa-header",title:"标题"},"|",{name:"unordered-list",action:e.toggleUnorderedList,className:"fa fa-list-ul",title:"无序列表"},{name:"ordered-list",action:e.toggleOrderedList,className:"fa fa-list-ol",title:"有序列表"},{name:"table",action:e.drawTable,className:"fa fa-table",title:"表格"},{name:"horizontal-rule",action:e.drawHorizontalRule,className:"fa fa-minus",title:"水平分隔线"},"|",{name:"code",action:e.toggleCodeBlock,className:"fa fa-code",title:"代码"},{name:"quote",action:e.toggleBlockquote,className:"fa fa-quote-left",title:"块引用"},{name:"link",action:e.drawLink,className:"fa fa-link",title:"链接"},{name:"image",action:this.showUpload,className:"fa fa-picture-o",title:"上传图片"},"|",{name:"preview",action:e.togglePreview,className:"fa fa-eye no-disable",title:"预览"},{name:"fullscreen",action:this.onToggleFullScreen,className:"fa fa-arrows-alt no-disable no-mobile",title:"全屏"}],this.SimpleMDE=e;var t=new e({element:this.$refs.textarea,promptURLs:!1,spellChecker:!1,toolbar:this.toolbar});this.simplemde=t;var o=e.prototype;o.getImageURL||(o.getImageURL=function(){return this.imageURL},o.setImageURL=function(e){this.imageURL=e});var a=this;this.simplemde.codemirror.on("change",function(){a.$emit("change",a.simplemde.value())}),this.simplemde.value(this.value)})},watch:{value:function(e,t){(e=e||"")!==this.simplemde.value()&&this.simplemde.value(e)}}}},s9AF:function(e,t,o){var a=o("yYM4");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);o("rjj0")("5d127327",a,!0)},y8ae:function(e,t,o){"use strict";t.a={SUCCESS:0,ERROR:1,LOGIN_TIMEOUT:1001,IN_ACTIVE:1002}},yYM4:function(e,t,o){t=e.exports=o("FZ+f")(!1),t.push([e.i,"body{background-color:#e1e1e1}.book-box{width:1200px;overflow:hidden;font-size:0;margin-left:auto;margin-right:auto}.book-nav{height:40px;padding-left:20px;background:#f6f6f6}.book-main,.book-nav{width:900px;display:inline-block}.book-nav li{float:left;line-height:40px}.book-nav a{color:#80bd01}.book-nav-sep{padding:0 8px}.book-nav span{font-size:14px}.book-label{color:#999}.editor-box-wrap{width:900px;padding-top:24px;min-height:720px;background:#fff}.book-area{clear:both;padding:0 20px 1px}.book-content .ivu-form-item-content{margin-left:0!important}.book-img{border:1px solid #f2f2f2;margin-bottom:10px}#uploader-pop-title{font-size:24px;font-weight:500;line-height:normal;height:32px;color:#262626}#uploader-pop-subheading{color:#8590a6}#avatarUploader{min-height:294px}",""])}});
//# sourceMappingURL=create.0c578a4a6e0239a9acf6.js.map